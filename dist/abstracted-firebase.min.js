!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.abstractedFirebase={})}(this,function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function u(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var a=require("typed-conversions"),u=require("serialized-query"),c=require("./util"),s=require("firemock"),f=require("./errors/FileDepthExceeded"),d=require("./errors/UndefinedAssignment");!function(e){e[e.true=1]="true",e[e.false=0]="false"}(e.FirebaseBoolean||(e.FirebaseBoolean={}));var h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._waitingForConnection=[],this._onConnected=[],this._onDisconnected=[],this._debugging=!1,this._mocking=!1,this._allowMocking=!1,t.mocking&&(this._mocking=!0,this._mock=new s.Mock)}var t,n,h;return t=e,(n=[{key:"query",value:function(e){return u.SerializedQuery.path(e)}},{key:"ref",value:function(t){return this._mocking?this.mock.ref(t):e.connection.ref(t)}},{key:"allowMocking",value:function(){this._allowMocking=!0}},{key:"resetMockDb",value:function(){s.resetDatabase()}},{key:"waitForConnection",value:function(){return i(this,void 0,void 0,function*(){var t=this;return e.isConnected?Promise.resolve():new Promise(function(e){t._waitingForConnection.push(function(){e()})})})}},{key:"set",value:function(e,t){return i(this,void 0,void 0,function*(){try{return this.ref(e).set(t)}catch(e){if(-1!==e.message.indexOf("path specified exceeds the maximum depth that can be written"))throw console.log("FILE DEPTH EXCEEDED"),new f.default(e);if("Error"===e.name&&(e.name="AbstractedFirebaseSetError"),-1!==e.message.indexOf("First argument contains undefined in property"))throw e.name="FirebaseUndefinedValueAssignment",new d.default(e);throw e}})}},{key:"multiPathSet",value:function(e){var t,n=[],r=this.ref.bind(this),o={_basePath:e||"/",basePath:function(e){return void 0===e?o._basePath:(o._basePath=e,o)},add:function(e){var t=new Set(o.paths);if(-1===e.path.indexOf("/")&&(e.path="/"+e.path),t.has(e.path)){var r=new Error('You have attempted to add the path "'.concat(e.path,'" twice.'));throw r.code="duplicate-path",r}return n.push(e),o},get paths(){return n.map(function(e){return e.path})},get fullPaths(){return n.map(function(e){return[o._basePath,e.path].join("/").replace(/[\/]{2,3}/g,"/")})},callback:function(e){t=e},execute:function(){return i(this,void 0,void 0,function*(){var e={};return n.map(function(e){return Object.assign({},e,{path:[o._basePath,e.path].join("/").replace(/[\/]{2,3}/g,"/")})}).map(function(t){e[t.path]=t.value}),r().update(e).then(function(){t&&t(null,n)}).catch(function(e){throw t&&t(e,n),e})})}};return o}},{key:"update",value:function(e,t){return i(this,void 0,void 0,function*(){try{return this.ref(e).update(t)}catch(e){throw"Error"===e.name&&(e.name="AbstractedFirebaseUpdateError"),-1!==e.message.indexOf("First argument path specified exceeds the maximum depth")&&(e.name="AbstractedFirebaseUpdateDepthError"),e}})}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i(this,void 0,void 0,function*(){var n=this;return this.ref(e).remove().catch(function(r){if(t&&-1!==r.message.indexOf("key is not defined"))return Promise.resolve();n.handleError(r,"remove","attempt to remove ".concat(e," failed: "))})})}},{key:"getSnapshot",value:function(e){return i(this,void 0,void 0,function*(){return"string"==typeof e?this.ref(c.slashNotation(e)).once("value"):e.setDB(this).execute()})}},{key:"getValue",value:function(e){return i(this,void 0,void 0,function*(){return(yield this.getSnapshot(e)).val()})}},{key:"getRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return i(this,void 0,void 0,function*(){return this.getSnapshot(e).then(function(e){var n,o,i,a=e.val();return"object"!==r(a)&&(a={value:e.val()}),Object.assign({},a,(n={},o=t,i=e.key,o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i,n))})})}},{key:"getList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return i(this,void 0,void 0,function*(){return this.getSnapshot(e).then(function(e){return e.val()?a.snapshotToArray(e,t):[]})})}},{key:"getSortedList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return i(this,void 0,void 0,function*(){return this.getSnapshot(e).then(function(e){return a.snapshotToArray(e,t)})})}},{key:"push",value:function(e,t){return i(this,void 0,void 0,function*(){this.ref(e).push(t)})}},{key:"exists",value:function(e){return i(this,void 0,void 0,function*(){return this.getSnapshot(e).then(function(e){return!!e.val()})})}},{key:"handleError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return console.error("Error ".concat(n,":"),e),Promise.reject({code:"firebase/".concat(t),message:n+e.message||e})}},{key:"mock",get:function(){if(!this._mocking&&!this._allowMocking)throw new Error("You can not mock the database without setting mocking in the constructor");return this._mock||(this._mock=new s.Mock,s.resetDatabase()),this._mock}},{key:"isConnected",get:function(){return e.isConnected}}])&&o(t.prototype,n),h&&o(t,h),e}();h.isConnected=!1,h.isAuthorized=!1,e.RealTimeDB=h;var l=Object.freeze({}),v=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})});t(v);var p=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_DONE=!0});t(p);p.NOT_DONE;var m=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})});t(m);var b=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NotYetDone=!0});t(b);b.NotYetDone;var y=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})});t(y);var g=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_DONE=!0});t(g);g.NOT_DONE;var _=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.rtdb=v,t.storage=p,t.firestore=m,t.messaging=b,t.app=y,t.auth=g});t(_);_.rtdb,_.storage,_.firestore,_.messaging,_.app,_.auth;var k=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l.RealTimeDB;var n=l;t.RealTimeDB=n.RealTimeDB,t.FirebaseBoolean=n.FirebaseBoolean,t.rtdb=_.rtdb,t.auth=_.auth}),w=t(k),O=k.RealTimeDB,P=k.FirebaseBoolean,D=k.rtdb,E=k.auth;e.default=w,e.RealTimeDB=O,e.FirebaseBoolean=P,e.rtdb=D,e.auth=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=abstracted-firebase.min.js.map
